"use strict";function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function t(e){return(t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function i(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function a(e,t,r){return(a=i()?Reflect.construct:function(e,t,i){var a=[null];a.push.apply(a,t);var r=new(Function.bind.apply(e,a));return i&&n(r,i.prototype),r}).apply(null,arguments)}function r(e){var i="function"==typeof Map?new Map:void 0;return(r=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(e))return i.get(e);i.set(e,r)}function r(){return a(e,arguments,t(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),n(r,e)})(e)}Object.defineProperty(exports,"__esModule",{value:!0});var s=["Alt","Control","Enter","Meta","Shift","Tab"];function l(e,t){return Array.from({length:t},(function(t,n){return n+e}))}function o(e,t,n){console.debug("[PIN Field] ("+e+") "+t+(n?": "+n:""))}function u(e){return Math.max(0,e-1)}function c(e,t){return 0===t?0:Math.min(e+1,t-1)}var d=function(t){var i,a;function r(){var e;return(e=t.apply(this,arguments)||this).cursor=0,e.actions=[],e.effects=[],e.fallback=null,e.inputs=[],e.length=5,e.validate=/^[a-zA-Z0-9]$/,e.format=function(e){return e},e}a=t,(i=r).prototype=Object.create(a.prototype),i.prototype.constructor=i,n(i,a);var d,h,p,f=r.prototype;return f.isKeyAllowed=function(e){return!!e&&!(e.length>1)&&("string"==typeof this.validate?this.validate.split("").includes(e):this.validate instanceof Array?this.validate.includes(e):this.validate instanceof RegExp?this.validate.test(e):this.validate(e))},f.attributeChangedCallback=function(e,t,n){var i=this;if(t!==n)switch(e){case"disabled":this.inputs.forEach((function(e){return e.disabled=i.disabled}))}},f.connectedCallback=function(){var e=this;if(this.hasAttribute("length")&&(this.length=Number(this.getAttribute("length"))||5,this.length<1))throw new RangeError("The PIN Field length should be greater than 0 (got "+this.length+")");var t=this.getAttribute("validate");"string"==typeof t&&(this.validate=t);var n=document.createElement("input");n.autocapitalize="off",n.autocomplete="off",n.inputMode="text";for(var i=[],a=function(t){var a=e.attributes[t];["id","autofocus"].includes(a.name)||(n.setAttribute(a.name,a.value),i.push((function(){return a&&e.removeAttribute(a.name)})))},r=0;r<this.attributes.length;r++)a(r);this.append.apply(this,l(0,this.length).map((function(t){var i=n.cloneNode(!0);return 0===t&&e.hasAttribute("autofocus")&&(i.autofocus=!0,e.removeAttribute("autofocus")),e.inputs.push(i),i})));var s=document.createElement("slot"),o=document.createElement("style");o.innerText=":host{display:flex;}",this.attachShadow({mode:"open"}).append(o,s),i.forEach((function(e){return e()})),this.inputs.forEach((function(t,n){t.addEventListener("keydown",e.handleKeyDown(n)),t.addEventListener("keyup",e.handleKeyUp(n)),t.addEventListener("paste",e.handlePaste(n))}))},f.disconnectedCallback=function(){var e=this;this.inputs.forEach((function(t,n){t.removeEventListener("keydown",e.handleKeyDown(n)),t.removeEventListener("keyup",e.handleKeyUp(n)),t.removeEventListener("paste",e.handlePaste(n))}))},f.applySetValAt=function(e,t){if(t.split("").slice(0,this.length).every(this.isKeyAllowed.bind(this))){var n,i=Math.min(t.length,this.length-e),a=c(i+e-1,this.length);(n=this.effects).push.apply(n,[{type:"handle-code-change"},{type:"focus-input",idx:a}].concat(l(0,i).flatMap((function(n){return[{type:"set-input-val",idx:e+n,val:t[n]},{type:"resolve-key",idx:e+n,key:t[n]}]}))))}else this.effects.push({type:"handle-code-change"},{type:"reject-key",idx:e,key:t},{type:"set-input-val",idx:e,val:""})},f.executeAll=function(){for(;this.actions.length>0;){var e=this.actions.pop();switch(e.type){case"handle-key-down":switch(o("action","handle-key-down","key="+e.key),e.key){case"Unidentified":this.fallback={idx:e.idx,val:e.val};break;case"Dead":this.effects=[{type:"handle-code-change"},{type:"reject-key",idx:e.idx,key:e.key},{type:"set-input-val",idx:e.idx,val:""}];break;case"ArrowLeft":this.cursor=u(e.idx),this.effects=[{type:"focus-input",idx:this.cursor}];break;case"ArrowRight":this.cursor=c(e.idx,this.length),this.effects=[{type:"focus-input",idx:this.cursor}];break;case"Delete":case"Backspace":this.effects=[{type:"handle-code-change"},{type:"handle-delete",idx:e.idx}];break;default:this.isKeyAllowed(e.key)?(this.cursor=c(e.idx,this.length),this.effects=[{type:"handle-code-change"},{type:"focus-input",idx:this.cursor},{type:"resolve-key",idx:e.idx,key:e.key},{type:"set-input-val",idx:e.idx,val:e.key}]):this.effects=[{type:"reject-key",idx:e.idx,key:e.key}]}break;case"handle-key-up":if(!this.fallback){o("action","handle-key-up","ignored");break}o("action","handle-key-up");var t=this.fallback,n=t.idx,i=t.val,a=e.val;""===i&&""===a?this.effects.push({type:"handle-delete",idx:n},{type:"handle-code-change"}):""!==i&&""!==a?(a=i===a[0]?a.substring(1):a.substring(0,a.length-1),this.applySetValAt(n,a)):""!==a&&this.applySetValAt(n,a),this.fallback=null;break;case"handle-paste":this.applySetValAt(e.idx,e.val)}}},f.applyAll=function(){for(;this.effects.length>0;){var e=this.effects.pop();switch(e.type){case"focus-input":o("effect","focus-input","idx="+e.idx),this.inputs[e.idx].focus();break;case"set-input-val":o("effect","set-input-val","idx="+e.idx+",val="+e.val);var t=this.format(e.val);this.inputs[e.idx].value=t;break;case"resolve-key":o("effect","resolve-key","idx="+e.idx+",key="+e.key),this.inputs[e.idx].setCustomValidity(""),this.dispatchEvent(new CustomEvent("resolve",{detail:{key:e.key}}));break;case"reject-key":o("effect","reject-key","idx="+e.idx+",key="+e.key),this.inputs[e.idx].setCustomValidity("Invalid key"),this.dispatchEvent(new CustomEvent("reject",{detail:{key:e.key}}));break;case"handle-delete":o("effect","handle-delete","idx="+e.idx);var n=this.inputs[e.idx].value;if(this.inputs[e.idx].setCustomValidity(""),this.inputs[e.idx].value="",!n){var i=u(e.idx);this.inputs[i].focus(),this.inputs[i].setCustomValidity(""),this.inputs[i].value=""}break;case"handle-code-change":var a=(document.documentElement.getAttribute("dir")||"ltr").toLowerCase(),r=this.inputs.map((function(e){return e.value.trim()})),s=("rtl"===a?r.reverse():r).join("");o("effect","handle-code-change","val={"+s+"}"),this.dispatchEvent(new CustomEvent("change",{detail:{value:s}})),s.length===this.length?(this.setAttribute("completed",""),this.dispatchEvent(new CustomEvent("complete",{detail:{value:s}}))):this.removeAttribute("completed")}}},f.render=function(){this.executeAll(),this.applyAll()},f.handleKeyDown=function(e){var t=this;return function(n){if(s.includes(n.key)||n.ctrlKey||n.altKey||n.metaKey)o("handleKeyDown","ignored","idx="+e+",key="+n.key);else if(n.target instanceof HTMLInputElement){n.preventDefault();var i=n.target.value;o("handleKeyDown","triggered","idx="+e+",key="+n.key+",val="+i),t.actions.push({type:"handle-key-down",idx:e,key:n.key,val:i}),t.render()}}},f.handleKeyUp=function(e){var t=this;return function(n){if(n.target instanceof HTMLInputElement){var i=n.target.value;o("handleKeyUp","triggered","idx="+e+",val="+i),t.actions.push({type:"handle-key-up",idx:e,val:i}),t.render()}}},f.handlePaste=function(e){var t=this;return function(n){n.preventDefault();var i=n.clipboardData?n.clipboardData.getData("Text"):"";o("handlePaste","triggered","idx="+e+",val="+i),t.actions.push({type:"handle-paste",idx:e,val:i}),t.render()}},d=r,p=[{key:"observedAttributes",get:function(){return["disabled"]}}],(h=[{key:"disabled",get:function(){return this.hasAttribute("disabled")},set:function(e){e?this.setAttribute("disabled",""):this.removeAttribute("disabled")}}])&&e(d.prototype,h),p&&e(d,p),r}(r(HTMLElement));customElements.define("swd-pin-field",d),exports.PinField=d,exports.default=d;
//# sourceMappingURL=pin-field.cjs.production.min.js.map
